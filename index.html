<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>問題集</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --text:#111827; --muted:#6b7280; --line:#e5e7eb;
      --accent:#2563eb; --radius:14px; --shadow:0 10px 30px rgba(0,0,0,.08); --drawer-head:54px;
      --row-pad-y:10px; --row-pad-x:14px; --row-gap:10px; --row-radius:12px; --row-font:.98rem; --badge-font:.86rem;
    }
    *{box-sizing:border-box}
    html, body{ height:100% }
    body{
      margin:0; min-height:100dvh;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic UI", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
      color:var(--text);
      background:linear-gradient(180deg,#fafafa, #eef2f7 60%, #e2e8f0);
      display:flex; align-items:center; justify-content:center;
      padding:18px; -webkit-font-smoothing:antialiased;
    }
    .app{
      width:min(920px,100%);
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      position:relative;
    }

    /* 透明マスク（外側クリックで閉じる用） */
    .mask{
      position:fixed; inset:0; background:transparent;
      display:none; z-index:3; touch-action:none;
    }
    .mask[data-open="true"]{ display:block }

    header{
      padding:14px 16px; border-bottom:1px solid var(--line);
      background:linear-gradient(180deg,#fff, #f9fafb);
    }
    h1{ margin:0; font-size:1.05rem; letter-spacing:.02em }

    main{ padding:14px 16px }
    .tiles{
      display:grid; gap:12px;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
    button.tile{
      appearance:none; cursor:pointer; background:#fff;
      border:1px solid var(--line); border-radius:12px;
      padding:14px; text-align:left;
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
      transition:.2s transform ease, .2s box-shadow ease; width:100%;
    }
    button.tile:hover{ transform:translateY(-1px); box-shadow:0 10px 26px rgba(0,0,0,.08) }
    .tile .title{ font-weight:700; font-size:1rem }
    .chev{ margin-left:auto; opacity:.7; transition: transform .2s ease }
    .tile[aria-expanded="true"] .chev{ transform:rotate(90deg) }

    /* Drawer（PC幅でもマスクより前面に：z=4） */
    .drawer{
      margin-top:14px; border:1px solid var(--line); border-radius:12px; background:#fff;
      display:none; position:relative; z-index:4;
    }
    .drawer[aria-hidden="false"]{ display:block }
    .drawer .head{
      position:sticky; top:0; z-index:1;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px 10px; border-bottom:1px solid var(--line); background:#f9fafb;
      height: var(--drawer-head);
    }
    .drawer .head h2{ margin:0; font-size:.98rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .close{
      appearance:none; cursor:pointer; background:#fff; color:#111827; border:1px solid var(--line);
      padding:6px 8px; border-radius:10px; font-size:.88rem;
    }
    .links{ padding:12px }

    /* ====== 縦並びの行（題名のみ・横スクロール対応） ====== */
    .vlist{ display:grid; gap:12px }
    .row{
      border:1px solid var(--line); border-radius:var(--row-radius); background:#fff;
      font-size:var(--row-font);
      transition:border-color .12s ease, box-shadow .12s ease;
    }
    .row:hover{ box-shadow:0 6px 16px rgba(0,0,0,.06); border-color:#d1d5db }
    .rowhead{
      display:flex; align-items:center; gap:var(--row-gap);
      width:100%; padding:var(--row-pad-y) var(--row-pad-x);
      min-width:0; user-select:none; cursor:pointer;
    }
    .title-wrap{ flex:1 1 auto; min-width:0 }
    .title-scroll{
      display:block; overflow-x:auto; white-space:nowrap; -webkit-overflow-scrolling:touch;
      mask-image: linear-gradient(to right, black 92%, transparent);
    }
    .title-scroll::-webkit-scrollbar{ height:6px }
    .title-scroll::-webkit-scrollbar-thumb{ background:#e5e7eb; border-radius:6px }

    footer{
      border-top:1px solid var(--line);
      padding:10px 12px; color:#6b7280; font-size:.86rem; background:#fff;
      display:flex; justify-content:space-between; align-items:center; gap:10px;
    }

    /* Mobile bottom sheet */
    @media (max-width:600px){
      .drawer{
        position: fixed; left: 50%; transform: translateX(-50%); bottom: 0; width: min(920px, 100%);
        height: 85vh; max-height: 85vh; border-radius: 16px 16px 0 0; box-shadow: 0 16px 40px rgba(0,0,0,.18);
        z-index: 5; overflow: hidden;
      }
      .drawer .links{
        height: calc(85vh - var(--drawer-head));
        overflow-y: auto; -webkit-overflow-scrolling: touch; overscroll-behavior: contain; padding-bottom: 12px;
      }
      .open-pill{ display:none !important; }
    }
  </style>
</head>
<body>
  <div class="mask" id="mask" aria-hidden="true"></div>
  <div class="app" aria-label="模擬試験集">
    <header><h1>模擬試験集</h1></header>
    <main>
      <div id="tiles" class="tiles"></div>
      <div id="drawers"></div>
    </main>
    <footer>
      <div>© <span id="y"></span> 模擬試験集</div><div></div>
    </footer>
  </div>

  <script>
    // 年号（nullガード付）
    const yEl = document.getElementById('y'); if (yEl) yEl.textContent = new Date().getFullYear();

    /* ====== データ ====== */
    const data = [
      {
        label: "過去分",
        children: [
          { label: "2020年 第1回診療情報管理士模擬試験", url: "https://0213mano-png.github.io/2020_1/" },
          { label: "2020年 第2回診療情報管理士模擬試験", url: "https://0213mano-png.github.io/2020_2/" },
          { label: "2020年 第3回診療情報管理士模擬試験", url: "https://0213mano-png.github.io/2020_3/" },
          { label: "2020年 第4回診療情報管理士模擬試験", url: "https://0213mano-png.github.io/2020_4/" },
          { label: "2021年 第1回診療情報管理士模擬試験", url: "https://0213mano-png.github.io/2021_1/" },
          { label: "2021年 第2回診療情報管理士模擬試験", url: "https://0213mano-png.github.io/2021_2/" },
          { label: "2022年 第2回診療情報管理士模擬試験", url: "https://0213mano-png.github.io/2022_1/" },
          { label: "2023年 第1回診療情報管理士模擬試験", url: "https://0213mano-png.github.io/2023_2/" },
          { label: "2023年 第2回診療情報管理士模擬試験", url: "https://0213mano-png.github.io/2023_3/" },
          { label: "2023年 第3回診療情報管理士模擬試験", url: "https://0213mano-png.github.io/2023_4/" },
          { label: "2025年 第1回診療情報管理士模擬試験", url: "https://0213mano-png.github.io/2025_1/" },
          { label: "2025年 第2回診療情報管理士模擬試験", url: "https://0213mano-png.github.io/2025_2/" },
          { label: "2025年 第3回診療情報管理士模擬試験", url: "https://0213mano-png.github.io/2025_3_2/" },
          { label: "2025年 第4回診療情報管理士模擬試験", url: "https://0213mano-png.github.io/2025_4/" }
        ]
      },
      {
        label: "項目別",
        children: [
          { label: "1章 医療管理総論", url: "https://0213mano-png.github.io/1/" },
          { label: "2章 医療管理各論Ⅰ", url: "https://0213mano-png.github.io/2/" },
          { label: "3章 医療管理各論Ⅱ", url: "https://0213mano-png.github.io/3/" },
          { label: "4章 医療管理各論Ⅲ", url: "https://0213mano-png.github.io/4/" },
          { label: "5章 保健医療情報学", url: "https://0213mano-png.github.io/5/" },
          { label: "6章 医療統計Ⅰ", url: "https://0213mano-png.github.io/6/" },
          { label: "7章 医療統計Ⅱ", url: "https://0213mano-png.github.io/7/" },
          { label: "8章 診療情報管理Ⅰ", url: "https://0213mano-png.github.io/8/" },
          { label: "9章 診療情報管理Ⅱ", url: "https://0213mano-png.github.io/9/" },
          { label: "10章 診療情報管理Ⅲ", url: "https://0213mano-png.github.io/10/" },
          { label: "11章 国際統計分類Ⅰ", url: "https://0213mano-png.github.io/11/" },
          { label: "12章 国際統計分類Ⅱ_ICD系", url: "https://0213mano-png.github.io/12/" },
          { label: "12章 国際統計分類Ⅱ_コード選択", url: "https://0213mano-png.github.io/2025_12_2/" },
          { label: "12章 国際統計分類Ⅱ_原死因・主要病名", url: "https://0213mano-png.github.io/2025_12_3/" },
          { label: "12章 国際統計分類Ⅱ_症例要約", url: "https://0213mano-png.github.io/2025_12_4/" }
        ]
      }
    ];

    /* ====== 要素参照 ====== */
    const tilesWrap = document.getElementById("tiles");
    const drawersWrap = document.getElementById("drawers");
    const mask = document.getElementById("mask");

    /* ====== 開閉制御 ====== */
    function closeAll(){
      for(const b of tilesWrap.querySelectorAll(".tile")) b.setAttribute("aria-expanded","false");
      for(const d of drawersWrap.querySelectorAll(".drawer")) d.setAttribute("aria-hidden","true");
      mask.dataset.open = "false"; mask.setAttribute("aria-hidden","true");
    }
    function openTarget(tile, drawer){
      closeAll();
      tile.setAttribute("aria-expanded","true");
      drawer.setAttribute("aria-hidden","false");
      mask.dataset.open = "true"; mask.setAttribute("aria-hidden","false");
      setTimeout(()=> drawer.scrollIntoView({behavior:"smooth", block:"start"}), 0);
    }
    function toggleTarget(tile, drawer){
      const isOpen = tile.getAttribute("aria-expanded") === "true";
      isOpen ? closeAll() : openTarget(tile, drawer);
    }

    /* ====== UI生成 ====== */
    function makeTile(id, title){
      const btn = document.createElement("button");
      btn.className = "tile";
      btn.id = `tile-${id}`;
      btn.setAttribute("aria-expanded","false");
      btn.setAttribute("aria-controls", `drawer-${id}`);
      btn.innerHTML = `
        <div><div class="title">${title}</div></div>
        <span class="chev" aria-hidden="true">▶</span>`;
      return btn;
    }
    function makeDrawer(id, title){
      const sec = document.createElement("section");
      sec.className = "drawer";
      sec.id = `drawer-${id}`;
      sec.setAttribute("aria-hidden","true");
      sec.innerHTML = `
        <div class="head">
          <h2>${title}</h2>
          <button class="close" type="button" data-close>閉じる</button>
        </div>
        <div class="links" id="list-${id}"></div>`;
      return sec;
    }

    // 1行（childrenの項目）: 題名のみ / 行クリック & Enter/Space で開く
    function makeRowItem({label, url}){
      const row  = document.createElement('div'); row.className = 'row';
      const head = document.createElement('div'); head.className = 'rowhead';
      head.setAttribute('role','link');   // アクセシビリティ
      head.setAttribute('tabindex','0');  // キーボードでフォーカス可能

      const titleWrap   = document.createElement('div');  titleWrap.className   = 'title-wrap';
      const titleScroll = document.createElement('span'); titleScroll.className = 'title-scroll';
      titleScroll.textContent = label;
      titleWrap.appendChild(titleScroll);

      // 行クリックで開く
      head.addEventListener('click', ()=> {
        window.open(url, '_blank', 'noopener,noreferrer');
      });
      // Enter / Space でも開く
      head.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' || e.key === ' ' || e.code === 'Space'){
          e.preventDefault();
          window.open(url, '_blank', 'noopener,noreferrer');
        }
      });

      head.appendChild(titleWrap);
      row.appendChild(head);
      return row;
    }

    function renderCategory(cat, idx){
      const id = `c${idx}`;
      const tile = makeTile(id, cat.label);
      const drawer = makeDrawer(id, cat.label);
      tilesWrap.appendChild(tile);
      drawersWrap.appendChild(drawer);

      const list = drawer.querySelector(`#list-${id}`);

      const sectionTitle = document.createElement('h2');
      sectionTitle.className = 'section-title';
      sectionTitle.textContent = cat.label;

      const vlist = document.createElement('div');
      vlist.className = 'vlist';
      (cat.children || []).forEach(child => vlist.appendChild(makeRowItem(child)));

      list.appendChild(sectionTitle);
      list.appendChild(vlist);

      tile.addEventListener("click", () => toggleTarget(tile, drawer));
      drawer.querySelector("[data-close]").addEventListener("click", closeAll);
    }

    data.forEach((cat, i) => renderCategory(cat, i));
    mask.addEventListener("click", closeAll);
  </script>
</body>
</html>
